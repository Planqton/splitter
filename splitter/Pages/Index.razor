@page "/"
@using System.IO

<PageTitle>Media Browser</PageTitle>

<h1>Media Browser</h1>

@if (files.Length == 0)
{
    <p>No .mkv files found in /media</p>
}
else
{
    <ul>
        @foreach (var file in files)
        {
            var name = Path.GetFileName(file);
            <li><a href="#" @onclick="() => SelectFile(name)">@name</a></li>
        }
    </ul>
}

@if (!string.IsNullOrEmpty(selectedFile))
{
    <h2>Playing: @selectedFile</h2>
    <video width="640" controls>
        <source src="@($"/media/{selectedFile}")" type="video/x-matroska" />
        Your browser does not support the video tag.
    </video>
}

@code {
    private string[] files = Array.Empty<string>();
    private string? selectedFile;

    protected override void OnInitialized()
    {
        if (Directory.Exists("/media"))
        {
            files = Directory.GetFiles("/media", "*.mkv");
        }
    }

    private void SelectFile(string file)
    {
        selectedFile = file;
    }
}
